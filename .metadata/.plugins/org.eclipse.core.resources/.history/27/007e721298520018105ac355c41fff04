package com.dr.service.system.impl;

import com.dr.common.BaseResult;
import com.dr.common.PageInfo;
import com.dr.common.SshSendUtil;
import com.dr.dao.system.SysAccessControlDAO;
import com.dr.model.system.SysAccessControl;
import com.dr.service.system.SysAccessControlService;

import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.Date;
import java.util.HashMap;
import java.util.List;

@Service
@Transactional
public class SysAccessControlServiceImpl implements SysAccessControlService {
	private Logger log = Logger.getLogger(SysAccessControlServiceImpl.class);
	
    @Autowired
    private SysAccessControlDAO sysAccessControlDAO;

    @Override
    public PageInfo getAccessControlList(SysAccessControl sysAccessControl,
    		PageInfo info) {
    	try {
			HashMap<String,Object> map = new HashMap<>();
			map.put("offset", info.getPageInfo().getOffset());
			map.put("limit",  info.getPageInfo().getLimit());
			map.put("ip", sysAccessControl.getIp());
			List<SysAccessControl> list = sysAccessControlDAO.getAccessControlList(map);
			int tatal = sysAccessControlDAO.getSysIpTotal(map);
			info.setTotal(tatal);
			info.setRows(list);
		} catch (Exception e) {
			log.error("查找IP数据失败"+e.getMessage());
		}
		return info;
    }

	@Override
	public BaseResult addSysIp(SysAccessControl sysAccessControl) {
		BaseResult result = new BaseResult();
		try {
			if(SshSendUtil.add(sysAccessControl.getIp())){
				sysAccessControl.setAddTime(new Date());
				sysAccessControlDAO.addSysIp(sysAccessControl);
				result.setSuccess(true);
				result.setMsg("添加数据成功");
			}
		} catch (Exception e) {
			log.error("添加IP数据失败"+e.getMessage());
			result.setSuccess(false);
			result.setMsg("添加数据失败");
		}
		return result;
	}


	@Override
	public BaseResult delSysIp(SysAccessControl sysAccessControl) {
		BaseResult result = new BaseResult();
		try {
			if(SshSendUtil.del(sysAccessControl.getIp())){
				sysAccessControlDAO.delSysIp(sysAccessControl);
				result.setSuccess(true);
				result.setMsg("删除数据成功");
			}
		} catch (Exception e) {
			log.error("删除IP数据失败"+e.getMessage());
			result.setSuccess(false);
			result.setMsg("删除数据失败");
		}
		return result;
	}
}